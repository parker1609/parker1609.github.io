<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>MyBatis 필드 및 파라미터 매핑 (with. Spring Boot) | Parker Blog</title><meta name=keywords content="MyBatis,SpringBoot,Java"><meta name=description content="이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.
이 글에 나오는 예제는 이 링크에서 확인할 수 있다.
Spring Boot 3.1.3 Java 17 mybatis-spring-boot-starter 3.0.2 mybatis 3.5.13 H2 Database 0. 예제 소개 매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다. 이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.
Movie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)"><meta name=author content="parker1609"><link rel=canonical href=https://parker1609.github.io/post/mybatis-mapping/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://parker1609.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://parker1609.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://parker1609.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://parker1609.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://parker1609.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)"><meta property="og:description" content="이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.
이 글에 나오는 예제는 이 링크에서 확인할 수 있다.
Spring Boot 3.1.3 Java 17 mybatis-spring-boot-starter 3.0.2 mybatis 3.5.13 H2 Database 0. 예제 소개 매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다. 이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.
Movie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)"><meta property="og:type" content="article"><meta property="og:url" content="https://parker1609.github.io/post/mybatis-mapping/"><meta property="og:image" content="https://parker1609.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-27T17:20:12+09:00"><meta property="article:modified_time" content="2023-08-27T17:20:12+09:00"><meta property="og:site_name" content="Parker Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://parker1609.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)"><meta name=twitter:description content="이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.
이 글에 나오는 예제는 이 링크에서 확인할 수 있다.
Spring Boot 3.1.3 Java 17 mybatis-spring-boot-starter 3.0.2 mybatis 3.5.13 H2 Database 0. 예제 소개 매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다. 이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.
Movie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://parker1609.github.io/post/"},{"@type":"ListItem","position":2,"name":"MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)","item":"https://parker1609.github.io/post/mybatis-mapping/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)","name":"MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)","description":"이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.\n이 글에 나오는 예제는 이 링크에서 확인할 수 있다.\nSpring Boot 3.1.3 Java 17 mybatis-spring-boot-starter 3.0.2 mybatis 3.5.13 H2 Database 0. 예제 소개 매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다. 이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.\nMovie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)","keywords":["MyBatis","SpringBoot","Java"],"articleBody":" 이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.\n이 글에 나오는 예제는 이 링크에서 확인할 수 있다.\nSpring Boot 3.1.3 Java 17 mybatis-spring-boot-starter 3.0.2 mybatis 3.5.13 H2 Database 0. 예제 소개 매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다. 이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.\nMovie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)\nCREATE TABLE movie ( movie_id INT PRIMARY KEY AUTO_INCREMENT, title VARCHAR NOT NULL, running_time INT NOT NULL, release_date DATE NOT NULL, director_id INT NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP, modified_at DATETIME DEFAULT CURRENT_TIMESTAMP ); Java에서의 객체는 다음과 같을 것이다.\npublic class Movie { private Long movieId; private String title; private Director director; private List\u003cGenre\u003e genres; private int runningTime; private LocalDate releaseDate; private LocalDateTime createdAt; private LocalDateTime modifiedAt; } (전체 DB 스키마는 여기 링크에서 확인할 수 있다.)\n1. 기본 필드 매핑 그러면 지금부터는 Mybatis에서 영화 정보에 대해서 조회를 해보자.\n그 전에 다시 DB 스키마와 자바 객체를 보자. 각 필드의 표현 형태를 보면 DB는 snake_case이고, Java는 camelCase 인 것을 볼 수 있다. 이는 일반적으로 많이 사용하는 형태이다.\n만약 SQL에서 DB의 필드 형태인 snake_case를 그대로 사용하면 어떻게 될까?\n","wordCount":"2143","inLanguage":"en","datePublished":"2023-08-27T17:20:12+09:00","dateModified":"2023-08-27T17:20:12+09:00","author":{"@type":"Person","name":"parker1609"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://parker1609.github.io/post/mybatis-mapping/"},"publisher":{"@type":"Organization","name":"Parker Blog","logo":{"@type":"ImageObject","url":"https://parker1609.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://parker1609.github.io/ accesskey=h title="파커 블로그 (Alt + H)"><img src=https://parker1609.github.io/apple-touch-icon.png alt aria-label=logo height=35>파커 블로그</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://parker1609.github.io/ title=Home><span>Home</span></a></li><li><a href=https://parker1609.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://parker1609.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://parker1609.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://parker1609.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://parker1609.github.io/post/>Posts</a></div><h1 class=post-title>MyBatis 필드 및 파라미터 매핑 (with. Spring Boot)</h1><div class=post-meta><span title='2023-08-27 17:20:12 +0900 KST'>August 27, 2023</span>&nbsp;·&nbsp;parker1609</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0-%ec%98%88%ec%a0%9c-%ec%86%8c%ea%b0%9c aria-label="0. 예제 소개">0. 예제 소개</a></li><li><a href=#1-%ea%b8%b0%eb%b3%b8-%ed%95%84%eb%93%9c-%eb%a7%a4%ed%95%91 aria-label="1. 기본 필드 매핑">1. 기본 필드 매핑</a><ul><li><a href=#11-db-alias-%ec%82%ac%ec%9a%a9 aria-label="1.1. DB alias 사용">1.1. DB alias 사용</a></li><li><a href=#12-mybatis-%ec%84%a4%ec%a0%95-%ec%b6%94%ea%b0%80 aria-label="1.2. Mybatis 설정 추가">1.2. Mybatis 설정 추가</a></li></ul></li><li><a href=#2-resultmap%ec%9d%84-%ed%99%9c%ec%9a%a9%ed%95%9c-%eb%b3%b5%ec%9e%a1%ed%95%9c-%eb%a7%a4%ed%95%91 aria-label="2. ResultMap을 활용한 복잡한 매핑">2. ResultMap을 활용한 복잡한 매핑</a><ul><ul><li><a href=#resultmap aria-label=&amp;lt;resultMap&amp;gt;><code>&lt;resultMap></code></a></li><li><a href=#id aria-label=&amp;lt;id&amp;gt;><code>&lt;id></code></a></li><li><a href=#result aria-label=&amp;lt;result&amp;gt;><code>&lt;result></code></a></li><li><a href=#association aria-label=&amp;lt;association&amp;gt;><code>&lt;association></code></a></li><li><a href=#collection aria-label=&amp;lt;collection&amp;gt;><code>&lt;collection></code></a></li></ul><li><a href=#21-association-collection-%ec%a4%91%ec%b2%a9-resultmap aria-label="2.1. &amp;lt;association&amp;gt;, &amp;lt;collection&amp;gt; 중첩 ResultMap">2.1. <code>&lt;association></code>, <code>&lt;collection></code> 중첩 ResultMap</a></li><li><a href=#22-association-collection-%ec%a4%91%ec%b2%a9-select aria-label="2.2. &amp;lt;association&amp;gt;, &amp;lt;collection&amp;gt; 중첩 select">2.2. <code>&lt;association></code>, <code>&lt;collection></code> 중첩 select</a></li><li><a href=#23-auto-mapping aria-label="2.3. Auto-Mapping">2.3. Auto-Mapping</a></li></ul></li><li><a href=#3-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0-%eb%a7%a4%ed%95%91 aria-label="3. 파라미터 매핑">3. 파라미터 매핑</a><ul><ul><li><a href=#param-%ec%96%b4%eb%85%b8%ed%85%8c%ec%9d%b4%ec%85%98-%ec%82%ac%ec%9a%a9 aria-label="@Param 어노테이션 사용"><code>@Param</code> 어노테이션 사용</a></li><li><a href=#parametertype-%ec%86%8d%ec%84%b1-%ec%82%ac%ec%9a%a9 aria-label="parameterType 속성 사용"><code>parameterType</code> 속성 사용</a></li></ul><li><a href=#31--vs- aria-label="3.1. #{} VS ${}">3.1. <code>#{}</code> VS <code>${}</code></a><ul><li><a href=#heading aria-label=#{}><code>#{}</code></a></li><li><a href=#heading-1 aria-label=${}><code>${}</code></a></li></ul></li></ul></li><li><a href=#4-%ec%a3%bc%ec%9d%98%ed%95%a0%ec%a0%90-%eb%b0%8f-tip aria-label="4. 주의할점 및 TIP">4. 주의할점 및 TIP</a><ul><li><a href=#%ec%a1%b0%ed%9a%8c-%ea%b2%b0%ea%b3%bc%eb%a1%9c-%eb%8a%94-%ec%82%ac%ec%9a%a9%ed%95%98%ec%a7%80-%eb%a7%90%ec%9e%90 aria-label="조회 결과로 *는 사용하지 말자">조회 결과로 <code>*</code>는 사용하지 말자</a></li></ul></li><li><a href=#%ec%b0%b8%ea%b3%a0%ec%9e%90%eb%a3%8c aria-label=참고자료>참고자료</a></li></ul></div></details></div><div class=post-content><blockquote><p>이 글은 Spring Boot 환경에서 MyBatis를 사용할 때, 기본적인 조회 결과의 매핑에 대해 정리한 글이다.</p><p>이 글에 나오는 예제는 <a href=https://github.com/programming-starter/spring-boot-mybatis-mapping>이 링크</a>에서 확인할 수 있다.</p></blockquote><ul><li>Spring Boot 3.1.3</li><li>Java 17</li><li>mybatis-spring-boot-starter 3.0.2<ul><li>mybatis 3.5.13</li></ul></li><li>H2 Database</li></ul><h1 id=0-예제-소개>0. 예제 소개<a hidden class=anchor aria-hidden=true href=#0-예제-소개>#</a></h1><p>매핑 테스트를 위한 간단한 영화(Movie) 예제를 살펴보자. 영화에 대한 정보를 저장하고 조회하는 서비스이다.
이 서비스의 ERD는 간단히 다음과 같이 만들어보았다.</p><p>Movie에 대한 DB 스키마는 다음과 같이 표현할 수 있다. (H2 Database 기준)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>movie</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>movie_id</span><span class=w>     </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>title</span><span class=w>        </span><span class=nb>VARCHAR</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>running_time</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>release_date</span><span class=w> </span><span class=nb>DATE</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>director_id</span><span class=w>  </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created_at</span><span class=w>   </span><span class=n>DATETIME</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>modified_at</span><span class=w>   </span><span class=n>DATETIME</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Java에서의 객체는 다음과 같을 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Movie</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Long</span> <span class=n>movieId</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>title</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Director</span> <span class=n>director</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Genre</span><span class=o>&gt;</span> <span class=n>genres</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>runningTime</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>LocalDate</span> <span class=n>releaseDate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>LocalDateTime</span> <span class=n>createdAt</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>LocalDateTime</span> <span class=n>modifiedAt</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>(전체 DB 스키마는 여기 링크에서 확인할 수 있다.)</p><h1 id=1-기본-필드-매핑>1. 기본 필드 매핑<a hidden class=anchor aria-hidden=true href=#1-기본-필드-매핑>#</a></h1><p>그러면 지금부터는 Mybatis에서 영화 정보에 대해서 조회를 해보자.</p><p>그 전에 다시 DB 스키마와 자바 객체를 보자.
각 필드의 표현 형태를 보면 DB는 <code>snake_case</code>이고, Java는 <code>camelCase</code> 인 것을 볼 수 있다.
이는 일반적으로 많이 사용하는 형태이다.</p><p>만약 SQL에서 DB의 필드 형태인 <code>snake_case</code>를 그대로 사용하면 어떻게 될까?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id
</span></span><span class=line><span class=cl>        , title
</span></span><span class=line><span class=cl>        , running_time
</span></span><span class=line><span class=cl>        , release_date
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위는 Mybatis에서 SQL을 사용하기 위한 XML 파일의 일부분이다.
단순히 전체 movie 테이블을 조회하는 모습이다.
이를 Java 객체 <code>Movie</code>에 매핑하면 어떻게 될까?
(아래에 나오는 영화 예제 데이터는 앞서 소개한 전체 예제 프로젝트 링크에서 확인할 수 있다.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>null, <span class=nv>title</span><span class=o>=</span>오펜하이머, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>0, <span class=nv>releaseDate</span><span class=o>=</span>null, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>null, <span class=nv>title</span><span class=o>=</span>인셉션, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>0, <span class=nv>releaseDate</span><span class=o>=</span>null, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>null, <span class=nv>title</span><span class=o>=</span>소울, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>0, <span class=nv>releaseDate</span><span class=o>=</span>null, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span></code></pre></div><p>조회 결과를 Java 객체로 매핑한 리스트를 출력하면 위와 같을 것이다.
title은 필드 표현 방식에 상관없이 같으므로 정상적으로 매핑되었지만,
매핑을 지도한 <code>movieId</code>, <code>runningTime</code>, releaseDate` 필드는 모두 null로 매핑을 하지 못하였다.
(나머지 Director, Genre 정보는 조인을 수행해야하고, 중첩? 객체를 사용해야하는데 이런 복잡한 매핑에 대해서는 아래에서 살펴볼 예정이다.)</p><p>위를 해결하는 방법은 여러가지가 있다.</p><h2 id=11-db-alias-사용>1.1. DB alias 사용<a hidden class=anchor aria-hidden=true href=#11-db-alias-사용>#</a></h2><p>첫 번째 방법은 단순히 SQL에서 제공해주는 필드명을 다른 이름으로 변경해주는 alias 기능을 사용하는 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl> <span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll&#34;</span> 
</span></span><span class=line><span class=cl>         <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id AS movieId
</span></span><span class=line><span class=cl>        , title
</span></span><span class=line><span class=cl>        , running_time AS runningTime
</span></span><span class=line><span class=cl>        , release_date AS releaseDate
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 결과를 보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1000, <span class=nv>title</span><span class=o>=</span>오펜하이머, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>180, <span class=nv>releaseDate</span><span class=o>=</span>2023-08-15, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1001, <span class=nv>title</span><span class=o>=</span>인셉션, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>148, <span class=nv>releaseDate</span><span class=o>=</span>2010-07-21, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1002, <span class=nv>title</span><span class=o>=</span>소울, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>107, <span class=nv>releaseDate</span><span class=o>=</span>2021-01-20, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span></code></pre></div><p>매핑을 시도한 필드에 대해서는 전체적으로 모두 잘 매핑이 되었다.</p><h2 id=12-mybatis-설정-추가>1.2. Mybatis 설정 추가<a hidden class=anchor aria-hidden=true href=#12-mybatis-설정-추가>#</a></h2><p>Mybatis 설정 중 필드 형식에 따라 매핑을 해주는 설정이 있다.
이를 사용한 예제를 살펴보자.</p><p>스프링 부트에서는 Mybatis 설정하는 방법은 크게 두 가지가 있다.</p><p>첫번째는 mybatis-config.xml 파일 내에 추가하는 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE configuration
</span></span></span><span class=line><span class=cl><span class=cp>        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- 자바 객체와 데이터베이스 필드 이름을 매핑할 전략을 설정합니다. --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;settings&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;setting</span> <span class=na>name=</span><span class=s>&#34;mapUnderscoreToCamelCase&#34;</span> <span class=na>value=</span><span class=s>&#34;true&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/settings&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>그리고 스프링 설정을 위한 application.yml(또는 application.properties) 파일 내에 설정하는 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>mybatis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>configuration</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>map-underscore-to-camel-case</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>스프링 부트를 사용한다면 첫번째 방식보다는 두번째 방식이 훨씬 간단하고 전체 설정을 관리하기가 한 눈에 볼 수 있어 편리하다.
(예제 프로젝트에서는 두번째 방식을 사용하고 있다.)</p><p>위 설정을 추가한 뒤, 다시 테스트를 해보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll&#34;</span> <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id
</span></span><span class=line><span class=cl>        , title
</span></span><span class=line><span class=cl>        , running_time
</span></span><span class=line><span class=cl>        , release_date
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1000, <span class=nv>title</span><span class=o>=</span>오펜하이머, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>180, <span class=nv>releaseDate</span><span class=o>=</span>2023-08-15, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1001, <span class=nv>title</span><span class=o>=</span>인셉션, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>148, <span class=nv>releaseDate</span><span class=o>=</span>2010-07-21, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1002, <span class=nv>title</span><span class=o>=</span>소울, <span class=nv>director</span><span class=o>=</span>null, <span class=nv>genres</span><span class=o>=</span>null, <span class=nv>runningTime</span><span class=o>=</span>107, <span class=nv>releaseDate</span><span class=o>=</span>2021-01-20, <span class=nv>createdAt</span><span class=o>=</span>null, <span class=nv>modifiedAt</span><span class=o>=</span>null<span class=o>)</span>
</span></span></code></pre></div><p>결과는 매핑이 정상적으로 잘된 모습을 볼 수 있다.</p><h1 id=2-resultmap을-활용한-복잡한-매핑>2. ResultMap을 활용한 복잡한 매핑<a hidden class=anchor aria-hidden=true href=#2-resultmap을-활용한-복잡한-매핑>#</a></h1><p>Mybatis에서는 ResultMap을 통해 복잡한 객체를 매핑할 수 있다.
nested object, collection와 같은 필드에 또다른 객체를 갖는 복잡한 매핑이 필요할 때 사용할 수 있다.</p><p>Movie 예제에서 지금까지는 Movie 테이블에 있는 필드만 매핑을 했었다.
감독과 장르 등 모든 정보를 매핑으르 하려면 ResultMap을 사용할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;movieResult&#34;</span> <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;movieId&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;title&#34;</span> <span class=na>column=</span><span class=s>&#34;title&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;runningTime&#34;</span> <span class=na>column=</span><span class=s>&#34;running_time&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;releaseDate&#34;</span> <span class=na>column=</span><span class=s>&#34;release_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;createdAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_created_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;modifiedAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_modified_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-one --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;association</span> <span class=na>property=</span><span class=s>&#34;director&#34;</span> <span class=na>javaType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Director&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;directorId&#34;</span> <span class=na>column=</span><span class=s>&#34;director_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;name&#34;</span> <span class=na>column=</span><span class=s>&#34;director_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;birthDate&#34;</span> <span class=na>column=</span><span class=s>&#34;birth_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;gender&#34;</span> <span class=na>column=</span><span class=s>&#34;gender&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;debutYear&#34;</span> <span class=na>column=</span><span class=s>&#34;debut_year&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;createdAt&#34;</span> <span class=na>column=</span><span class=s>&#34;director_created_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;modifiedAt&#34;</span> <span class=na>column=</span><span class=s>&#34;director_modified_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/association&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-many --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;genres&#34;</span> <span class=na>ofType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Genre&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;genreId&#34;</span> <span class=na>column=</span><span class=s>&#34;genre_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;genreType&#34;</span> <span class=na>column=</span><span class=s>&#34;genre_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/collection&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll2&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;movieResult&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT m.movie_id,
</span></span><span class=line><span class=cl>           m.title,
</span></span><span class=line><span class=cl>           m.running_time,
</span></span><span class=line><span class=cl>           m.release_date,
</span></span><span class=line><span class=cl>           m.director_id,
</span></span><span class=line><span class=cl>           m.created_at  AS movie_created_at,
</span></span><span class=line><span class=cl>           m.modified_at AS movie_modified_at,
</span></span><span class=line><span class=cl>           d.director_id,
</span></span><span class=line><span class=cl>           d.name        AS director_name,
</span></span><span class=line><span class=cl>           d.birth_date,
</span></span><span class=line><span class=cl>           d.gender,
</span></span><span class=line><span class=cl>           d.debut_year,
</span></span><span class=line><span class=cl>           d.created_at  AS director_created_at,
</span></span><span class=line><span class=cl>           d.modified_at AS director_modified_at,
</span></span><span class=line><span class=cl>           g.genre_id,
</span></span><span class=line><span class=cl>           g.name        AS genre_name
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl>             INNER JOIN director d ON m.director_id = d.director_id
</span></span><span class=line><span class=cl>             INNER JOIN movie_genre_relation mgr ON m.movie_id = mgr.movie_id
</span></span><span class=line><span class=cl>             INNER JOIN genre g ON mgr.genre_id = g.genre_id
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>ResultMap을 선언하기 위해서는 <code>&lt;resultMap></code> 엘리먼트를 선언해야 한다.
선언한 ResultMap을 사용하기 위해서는 <code>&lt;select></code> 엘리먼트의 속성 중 <code>resultMap</code>을 사용하여
<code>&lt;resultMap></code> 엘리먼트의 id 속성에 선언해준 값을 넣어주면 된다.</p><p>위 조회 결과는 다음과 같다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1000, <span class=nv>title</span><span class=o>=</span>오펜하이머, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>크리스토퍼 놀란, <span class=nv>birthDate</span><span class=o>=</span>1970-07-30, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>100, <span class=nv>debutYear</span><span class=o>=</span>1989, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.135906, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.135906<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>1, <span class=nv>genreType</span><span class=o>=</span>DRAMA<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>2, <span class=nv>genreType</span><span class=o>=</span>THRILLER<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>3, <span class=nv>genreType</span><span class=o>=</span>WAR<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>180, <span class=nv>releaseDate</span><span class=o>=</span>2023-08-15, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.134188, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.134188<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1001, <span class=nv>title</span><span class=o>=</span>인셉션, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>크리스토퍼 놀란, <span class=nv>birthDate</span><span class=o>=</span>1970-07-30, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>100, <span class=nv>debutYear</span><span class=o>=</span>1989, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.135906, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.135906<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>4, <span class=nv>genreType</span><span class=o>=</span>CRIME<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>5, <span class=nv>genreType</span><span class=o>=</span>SF<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>6, <span class=nv>genreType</span><span class=o>=</span>ACTION<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>148, <span class=nv>releaseDate</span><span class=o>=</span>2010-07-21, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.134917, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.134917<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1002, <span class=nv>title</span><span class=o>=</span>소울, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>피트 닥터, <span class=nv>birthDate</span><span class=o>=</span>1968-10-09, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>101, <span class=nv>debutYear</span><span class=o>=</span>1988, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.136104, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.136104<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>7, <span class=nv>genreType</span><span class=o>=</span>ANIMATION<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>8, <span class=nv>genreType</span><span class=o>=</span>COMEDY<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>9, <span class=nv>genreType</span><span class=o>=</span>FAMILY<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>107, <span class=nv>releaseDate</span><span class=o>=</span>2021-01-20, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:01:10.135113, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:01:10.135113<span class=o>)</span>
</span></span></code></pre></div><p>길긴하지만, 쭉 살펴보면 모든 정보가 잘 매핑된 것을 볼 수 있다.</p><p>위 예제에서 사용한 내부 엘리먼트와 속성에 대해서 알아보자.
(가장 범용적으로 사용하는 것만 선언한 예제이며, 더 자세한 내용은 <a href=https://mybatis.org/mybatis-3/ko/sqlmap-xml.html#result-maps>공식 문서의 ResultMap 섹션</a>을 참고하자.)</p><h3 id=resultmap><code>&lt;resultMap></code><a hidden class=anchor aria-hidden=true href=#resultmap>#</a></h3><p>ResultMap을 선언하기 위한 엘리먼트.</p><ul><li><code>id</code>: ResultMap의 id를 지정한다.</li><li><code>type</code>: ResultMap이 매핑할 객체의 클래스를 지정한다.</li></ul><h3 id=id><code>&lt;id></code><a hidden class=anchor aria-hidden=true href=#id>#</a></h3><p>각 엘리먼트의 id를 선언하는 내부 엘리먼트. (이를 선언하는 것이 성능 향상에 도움이 된다고 한다.)</p><ul><li><code>property</code>: Java 객체의 필드 중 매핑할 이름</li><li><code>column</code>: DB 필드 중 매핑할 이름</li></ul><blockquote><p><code>property</code>와 <code>column</code> 속성은 Java와 DB를 매핑하는 엘리먼트는 모두 사용할 수 있으므로,
이후 엘리먼트의 속성 설명에는 제외한다.</p></blockquote><h3 id=result><code>&lt;result></code><a hidden class=anchor aria-hidden=true href=#result>#</a></h3><p>각 엘리먼트의 일반 필드를 선언하는 내부 엘리먼트</p><h3 id=association><code>&lt;association></code><a hidden class=anchor aria-hidden=true href=#association>#</a></h3><p>객체와 <code>has-one</code> 관계의 내부 객체를 매핑할 때 사용하는 엘리먼트.</p><p>예제를 기준으로 영화는 한 명의 감독이 있다고 정의하였다.
그러므로 Movie 객체 내부에는 하나의 Director 객체가 존재하므로 has-one 관계이다.</p><ul><li><code>property</code>: Java 객체의 필드 중 매핑할 이름</li><li><code>javaType</code>: 매핑할 객체의 클래스 타입</li></ul><h3 id=collection><code>&lt;collection></code><a hidden class=anchor aria-hidden=true href=#collection>#</a></h3><p>객체와 <code>has-many</code> 관계의 내부 컬렉션을 매핑할 때 사용하는 엘리먼트.</p><p>객체 내부에 컬렉션이 존재하는 경우 사용하는 엘리먼트이다.
예제를 기준으로 하나의 영화는 여러 개의 장르를 갖는다. 이는 has-many 관계이다.</p><ul><li><code>property</code>: Java 객체의 필드 중 매핑할 이름</li><li><code>ofType</code>: 매핑할 컬렉션의 클래스 타입</li><li><code>javaType</code>: 매핑할 컬렉션 타입 (ex, <code>ArrayList</code>, <code>HashSet</code> 등)</li></ul><h2 id=21-association-collection-중첩-resultmap>2.1. <code>&lt;association></code>, <code>&lt;collection></code> 중첩 ResultMap<a hidden class=anchor aria-hidden=true href=#21-association-collection-중첩-resultmap>#</a></h2><p><code>&lt;association></code>, <code>&lt;collection></code> 두 엘리먼트는 속성으로 resultMap을 선언하여,
또 다른 ResultMap을 사용할 수 있다.</p><p>위에서 살펴봤던 같은 조회 예제를 중첩 ResultMap을 사용하여 다시 작성해보자.
(select 문은 같으므로 생략한다.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;movieResultUsingNestedResult&#34;</span> <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;movieId&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;title&#34;</span> <span class=na>column=</span><span class=s>&#34;title&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;runningTime&#34;</span> <span class=na>column=</span><span class=s>&#34;running_time&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;releaseDate&#34;</span> <span class=na>column=</span><span class=s>&#34;release_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;createdAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_created_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;modifiedAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_modified_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-one --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;association</span> <span class=na>property=</span><span class=s>&#34;director&#34;</span> <span class=na>column=</span><span class=s>&#34;director_id&#34;</span>
</span></span><span class=line><span class=cl>                 <span class=na>javaType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Director&#34;</span>
</span></span><span class=line><span class=cl>                 <span class=na>resultMap=</span><span class=s>&#34;directorResult&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-many --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;genres&#34;</span> <span class=na>ofType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Genre&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>resultMap=</span><span class=s>&#34;genreResult&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;directorResult&#34;</span> <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Director&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;directorId&#34;</span> <span class=na>column=</span><span class=s>&#34;director_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;name&#34;</span> <span class=na>column=</span><span class=s>&#34;director_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;birthDate&#34;</span> <span class=na>column=</span><span class=s>&#34;birth_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;gender&#34;</span> <span class=na>column=</span><span class=s>&#34;gender&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;debutYear&#34;</span> <span class=na>column=</span><span class=s>&#34;debut_year&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;createdAt&#34;</span> <span class=na>column=</span><span class=s>&#34;director_created_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;modifiedAt&#34;</span> <span class=na>column=</span><span class=s>&#34;director_modified_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;genreResult&#34;</span> <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Genre&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;genreId&#34;</span> <span class=na>column=</span><span class=s>&#34;genre_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;genreType&#34;</span> <span class=na>column=</span><span class=s>&#34;genre_name&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>Movie 객체의 ResultMap 내부에 있던 Director, Genre 객체의 ResultMap을 따로 분리하여 선언하였다.
그리고 각각 이를 사용하도록 resultMap에 선언해주었다.
이를 동작시켜보면 위 예제와 같은 결과를 얻을 수 있다.</p><p>이렇게 하면, Director와 Genre 객체에 대한 ResultMap을 재사용할 수 있으므로 코드의 중복을 줄일 수 있다.</p><h2 id=22-association-collection-중첩-select>2.2. <code>&lt;association></code>, <code>&lt;collection></code> 중첩 select<a hidden class=anchor aria-hidden=true href=#22-association-collection-중첩-select>#</a></h2><p><code>&lt;association></code>, <code>&lt;collection></code> 두 엘리먼트는 속성으로 select를 선언하여,
다른 select문으로 내부 객체 또는 컬렉션을 조회할 수 있다.</p><p>이는 위의 사용법과는 다른 점이 있어 주의깊게 살펴보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll4&#34;</span> <span class=na>resultMap=</span><span class=s>&#34;movieResultUsingNestedSelect&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT m.movie_id,
</span></span><span class=line><span class=cl>           m.title,
</span></span><span class=line><span class=cl>           m.running_time,
</span></span><span class=line><span class=cl>           m.release_date,
</span></span><span class=line><span class=cl>           m.director_id,
</span></span><span class=line><span class=cl>           m.created_at  AS movie_created_at,
</span></span><span class=line><span class=cl>           m.modified_at AS movie_modified_at
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>먼저 시작하는 쿼리에서는 Movie 테이블만 모든 필드를 조회한다.
Director, Genre 테이블은 따로 select 문을 작성할 것이기 때문이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;movieResultUsingNestedSelect&#34;</span> <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;movieId&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;title&#34;</span> <span class=na>column=</span><span class=s>&#34;title&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;runningTime&#34;</span> <span class=na>column=</span><span class=s>&#34;running_time&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;releaseDate&#34;</span> <span class=na>column=</span><span class=s>&#34;release_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;createdAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_created_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;modifiedAt&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_modified_at&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-one --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;association</span> <span class=na>property=</span><span class=s>&#34;director&#34;</span> <span class=na>column=</span><span class=s>&#34;director_id&#34;</span>
</span></span><span class=line><span class=cl>                 <span class=na>javaType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Director&#34;</span>
</span></span><span class=line><span class=cl>                 <span class=na>select=</span><span class=s>&#34;selectDirectorResult&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!-- has-many --&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;collection</span> <span class=na>property=</span><span class=s>&#34;genres&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_id&#34;</span> <span class=na>javaType=</span><span class=s>&#34;ArrayList&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>ofType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Genre&#34;</span>
</span></span><span class=line><span class=cl>                <span class=na>select=</span><span class=s>&#34;selectGenreResult&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>그리고 ResultMap의 내부 <code>&lt;association></code>, <code>&lt;collection></code> 엘리먼트는 각각 select를 선언하여 다른 select문을 사용한다고 설정한다.
여기서 주의할 점이 <code>column</code> 속성이다. 이는 내부 select 문에서 사용할 <code>id</code> 파라미터를 지정하는 것이다.
(파라미터에 대한 자세한 설명은 아래에서 다룰 예정이다.)</p><p>Director는 movie 테이블에 직접 director_id가 존재하므로 <code>column="director_id"</code>로 설정하였다.
하지만 Genre는 movie 테이블에는 genre_id가 존재하지 않고,
movie_genre_relation 테이블에서 movie와 genre 관계를 나타낸다.
그러므로 movie에 해당하는 genre 정보는 위 테이블에서 movie_id로 조인해서 가져올 수 있다.</p><p>이를 바탕으로 중첩 select 문을 작성해보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectDirectorResult&#34;</span> <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Director&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT d.director_id,
</span></span><span class=line><span class=cl>           d.name,
</span></span><span class=line><span class=cl>           d.birth_date,
</span></span><span class=line><span class=cl>           d.gender,
</span></span><span class=line><span class=cl>           d.debut_year,
</span></span><span class=line><span class=cl>           d.created_at,
</span></span><span class=line><span class=cl>           d.modified_at
</span></span><span class=line><span class=cl>    FROM director d
</span></span><span class=line><span class=cl>    WHERE d.director_id = #{id}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectGenreResult&#34;</span> <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Genre&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT g.genre_id,
</span></span><span class=line><span class=cl>           g.name as genre_type
</span></span><span class=line><span class=cl>    FROM genre g
</span></span><span class=line><span class=cl>             INNER JOIN movie_genre_relation mgr ON g.genre_id = mgr.genre_id
</span></span><span class=line><span class=cl>    WHERE mgr.movie_id = #{id}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위를 모두 작성하여 실행해보면, 똑같이 모든 정보를 정상적으로 가져오는 것을 확인할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1000, <span class=nv>title</span><span class=o>=</span>오펜하이머, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>크리스토퍼 놀란, <span class=nv>birthDate</span><span class=o>=</span>1970-07-30, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>100, <span class=nv>debutYear</span><span class=o>=</span>1989, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.172540, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.172540<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>1, <span class=nv>genreType</span><span class=o>=</span>DRAMA<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>2, <span class=nv>genreType</span><span class=o>=</span>THRILLER<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>3, <span class=nv>genreType</span><span class=o>=</span>WAR<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>180, <span class=nv>releaseDate</span><span class=o>=</span>2023-08-15, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.171067, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.171067<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1001, <span class=nv>title</span><span class=o>=</span>인셉션, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>크리스토퍼 놀란, <span class=nv>birthDate</span><span class=o>=</span>1970-07-30, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>100, <span class=nv>debutYear</span><span class=o>=</span>1989, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.172540, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.172540<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>4, <span class=nv>genreType</span><span class=o>=</span>CRIME<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>5, <span class=nv>genreType</span><span class=o>=</span>SF<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>6, <span class=nv>genreType</span><span class=o>=</span>ACTION<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>148, <span class=nv>releaseDate</span><span class=o>=</span>2010-07-21, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.171671, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.171671<span class=o>)</span>
</span></span><span class=line><span class=cl>Movie<span class=o>(</span><span class=nv>movieId</span><span class=o>=</span>1002, <span class=nv>title</span><span class=o>=</span>소울, <span class=nv>director</span><span class=o>=</span>Director<span class=o>(</span><span class=nv>super</span><span class=o>=</span>Person<span class=o>(</span><span class=nv>name</span><span class=o>=</span>피트 닥터, <span class=nv>birthDate</span><span class=o>=</span>1968-10-09, <span class=nv>gender</span><span class=o>=</span>MALE<span class=o>)</span>, <span class=nv>directorId</span><span class=o>=</span>101, <span class=nv>debutYear</span><span class=o>=</span>1988, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.172717, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.172717<span class=o>)</span>, <span class=nv>genres</span><span class=o>=[</span>Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>7, <span class=nv>genreType</span><span class=o>=</span>ANIMATION<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>8, <span class=nv>genreType</span><span class=o>=</span>COMEDY<span class=o>)</span>, Genre<span class=o>(</span><span class=nv>genreId</span><span class=o>=</span>9, <span class=nv>genreType</span><span class=o>=</span>FAMILY<span class=o>)]</span>, <span class=nv>runningTime</span><span class=o>=</span>107, <span class=nv>releaseDate</span><span class=o>=</span>2021-01-20, <span class=nv>createdAt</span><span class=o>=</span>2023-09-10T10:48:56.171862, <span class=nv>modifiedAt</span><span class=o>=</span>2023-09-10T10:48:56.171862<span class=o>)</span>
</span></span></code></pre></div><p>중첩 select의 문제는 N + 1 문제가 발생한다는 것이다. (JPA를 사용해보신 분들은 아주 익숙한 문제일 것이다.)</p><ul><li>1: movie 테이블을 조회하는 기본이되는 select 문</li><li>N: movie 테이블의 조회 결과 개수만큼 내부 정보를 채우기 위해 중첩 select 문이 실행된다.</li></ul><p>즉, 하나의 쿼리(1)를 실행하면, 그 결과 개수만큼 다시 쿼리가 N번 실행되므로 성능에 문제가 발생할 수 있다.
그리고 시작 쿼리에서 어떤 정보를 가져오는지 한 눈에 볼 수 없어 유지보수하는데 더욱 어려워질 수 있다.
따라서 이 방법은 개인적으로 크게 추천하지 않는 방식이며, 이러한 방법이 있다 정보만 알고 있어도 될 듯 하다.</p><h2 id=23-auto-mapping>2.3. Auto-Mapping<a hidden class=anchor aria-hidden=true href=#23-auto-mapping>#</a></h2><p>Mybatis는 ResultMap을 선언하지 않아도 자동으로 매핑해주는 기능이 있다. 이를 Auto-Mapping이라고 한다.
단순한 예제를 위해 기본 매핑에서 살펴본 예제를 ResultMap으로 바꿔보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll&#34;</span> <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id
</span></span><span class=line><span class=cl>        , title
</span></span><span class=line><span class=cl>        , running_time
</span></span><span class=line><span class=cl>        , release_date
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>기본 매핑 예제에서는 위처럼 설정하였는데, 반환을 ResultMap으로 바꾸어보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectAll&#34;</span> <span class=na>resultType=</span><span class=s>&#34;MovieResult&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id       AS movieId
</span></span><span class=line><span class=cl>        , title
</span></span><span class=line><span class=cl>        , running_time AS runningTime
</span></span><span class=line><span class=cl>        , release_date AS releaseDate
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;MovieResult&#34;</span> 
</span></span><span class=line><span class=cl>           <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;id</span> <span class=na>property=</span><span class=s>&#34;movieId&#34;</span> <span class=na>column=</span><span class=s>&#34;movie_id&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;title&#34;</span> <span class=na>column=</span><span class=s>&#34;title&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;runningTime&#34;</span> <span class=na>column=</span><span class=s>&#34;running_time&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;result</span> <span class=na>property=</span><span class=s>&#34;releaseDate&#34;</span> <span class=na>column=</span><span class=s>&#34;release_date&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>여기서 자동 매핑을 적용한다고 하면 ResultMap은 훨씬 간단해진다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;resultMap</span> <span class=na>id=</span><span class=s>&#34;MovieResult&#34;</span> 
</span></span><span class=line><span class=cl>           <span class=na>type=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>Java 객체의 필드 이름과 모두 동일하므로, 사실 선언해줄 필요가 없다.
이는 자동 매핑의 기본값 설정이 <code>PARTIAL</code> 이므로 아무런 설정없이도 위처럼 사용할 수 있다.
자동 매핑은 3가지 설정값을 갖는다.</p><ul><li><code>NONE</code>: 자동 매핑을 사용하지 않는다.</li><li><code>PARTIAL</code>: 조인된 테이블의 결과매핑을 제외하고 자동 매핑한다.</li><li><code>FULL</code>: 조인을 포함하여 모든 필드를 자동매핑한다.</li></ul><p>이는 글로벌하게 적용할 수도 있지만, ResultMap에의 속성으로 해당 ResultMap에만 따로 적용할 수도 있다.</p><h1 id=3-파라미터-매핑>3. 파라미터 매핑<a hidden class=anchor aria-hidden=true href=#3-파라미터-매핑>#</a></h1><p>만약 영화 예제에서 &lsquo;오펜하이머&rsquo; 영화에 대한 정보를 조회하고 싶을 때 어떻게 할까?
movie 테이블의 title에 조건을 걸어주면 될 것이다.
이와 같이, 특정 값으로 조건을 설정하고 싶을 때 Mybatis에서는 이 값을 파라미터로 변수를 넘겨줄 수 있다.</p><p>예제 코드를 보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Mapper</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MovieMapper</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Movie</span> <span class=nf>selectByTitle</span><span class=o>(</span><span class=n>String</span> <span class=n>title</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByTitle&#34;</span> <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT
</span></span><span class=line><span class=cl>        movie_id
</span></span><span class=line><span class=cl>         , title
</span></span><span class=line><span class=cl>         , running_time
</span></span><span class=line><span class=cl>         , release_date
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl>    WHERE m.title = #{title}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>이렇게 넘겨준 파라미터를 <code>#{}</code>으로 감싸주면 된다.</p><p>만약 파라미터가 여러 개라면 어떨까?</p><p>2023년 이후에 개봉한 영화 중 런닝타임이 180분 이상인 영화들을 모두 조회해보자.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Mapper</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MovieMapper</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Movie</span> <span class=nf>selectByReleaseDateAndRunningTime</span><span class=o>(</span><span class=n>LocalDate</span> <span class=n>releaseDate</span><span class=o>,</span> <span class=kt>int</span> <span class=n>runningTime</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByReleaseDateAndRunningTime&#34;</span> 
</span></span><span class=line><span class=cl>        <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  SELECT movie_id
</span></span><span class=line><span class=cl>    , title
</span></span><span class=line><span class=cl>    , running_time
</span></span><span class=line><span class=cl>    , release_date
</span></span><span class=line><span class=cl>  FROM movie m
</span></span><span class=line><span class=cl>  WHERE m.release_date &gt;= #{releaseDate}
</span></span><span class=line><span class=cl>      AND m.running_time &gt;= #{runningTime}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 결과로 &lsquo;오펜하이머&rsquo; 영화에 대한 정보가 조회될 것이다.</p><p>만약 파라미터가 너무 많아진다면 어떨까?
일일이 파라미터로 선언하기보다는 객체로 감싸서 넘겨주고 싶을 것이다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelectCriteria</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=n>LocalDate</span> <span class=n>releaseDate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kt>int</span> <span class=n>runningTime</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MovieMapper</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Movie</span> <span class=nf>selectByReleaseDateAndRunningTime2</span><span class=o>(</span><span class=n>SelectCriteria</span> <span class=n>selectCriteria</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>앞선 예제와 동일한 예제에서 넘겨주는 파라미터만 SelectCriteria라는 객체로 넘겨주었다.</p><p>이를 사용하는 방법은 크게 두가지가 있다.</p><h3 id=param-어노테이션-사용><code>@Param</code> 어노테이션 사용<a hidden class=anchor aria-hidden=true href=#param-어노테이션-사용>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.apache.ibatis.annotations.Param</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MovieMapper</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Movie</span> <span class=nf>selectByReleaseDateAndRunningTime2</span><span class=o>(</span><span class=nd>@Param</span><span class=o>(</span><span class=s>&#34;selectCriteria&#34;</span><span class=o>)</span> <span class=n>SelectCriteria</span> <span class=n>selectCriteria</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByReleaseDateAndRunningTime2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    SELECT movie_id
</span></span><span class=line><span class=cl>         , title
</span></span><span class=line><span class=cl>         , running_time
</span></span><span class=line><span class=cl>         , release_date
</span></span><span class=line><span class=cl>    FROM movie m
</span></span><span class=line><span class=cl>    WHERE m.release_date &gt;= #{selectCriteria.releaseDate}
</span></span><span class=line><span class=cl>      AND m.running_time &gt;= #{selectCriteria.runningTime}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id=parametertype-속성-사용><code>parameterType</code> 속성 사용<a hidden class=anchor aria-hidden=true href=#parametertype-속성-사용>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>MovieMapper</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>Movie</span> <span class=nf>selectByReleaseDateAndRunningTime2</span><span class=o>(</span><span class=n>SelectCriteria</span> <span class=n>selectCriteria</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;select</span> <span class=na>id=</span><span class=s>&#34;selectByReleaseDateAndRunningTime2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>parameterType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.SelectCriteria&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>resultType=</span><span class=s>&#34;me.parker.springbootmybatismapping.model.Movie&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  SELECT movie_id
</span></span><span class=line><span class=cl>    , title
</span></span><span class=line><span class=cl>    , running_time
</span></span><span class=line><span class=cl>    , release_date
</span></span><span class=line><span class=cl>  FROM movie m
</span></span><span class=line><span class=cl>  WHERE m.release_date &gt;= #{releaseDate}
</span></span><span class=line><span class=cl>    AND m.running_time &gt;= #{runningTime}
</span></span><span class=line><span class=cl><span class=nt>&lt;/select&gt;</span>
</span></span></code></pre></div><p>select 엘리먼트의 <code>parameterType</code>을 사용하면, SelectCriteria라는 이름의 객체를 선언할 필요없이 그 필드만 선언할 수도 있다.</p><h2 id=31--vs->3.1. <code>#{}</code> VS <code>${}</code><a hidden class=anchor aria-hidden=true href=#31--vs->#</a></h2><p>사실 Mybatis에서는 매핑 방법으로 <code>#{}</code>과 <code>${}</code> 두 가지 표현식을 사용할 수 있다.
위에서는 <code>#{}</code>을 사용하였는데, <code>#{}</code>과 <code>${}</code>의 차이점은 무엇일까?</p><h3 id=heading><code>#{}</code><a hidden class=anchor aria-hidden=true href=#heading>#</a></h3><p><code>#{}</code>는 파라미터를 자동으로 PreparedStatement에 바인딩해준다.
따라서 SQL Injection 공격을 방어하는 등 안전하게 파라미터를 사용할 수 있다.</p><p>하지만 문자 그대로 사용하고 싶은 경우가 있다.
WHERE 조건문이 아니라 테이블 이름이나 ORDER BY 절에서 어떤 필드로 할지 또는 오름차순을 할지 내림차순을 할지 등의 경우가 있다.
이 때는 <code>#{}</code>을 사용하면 안된다.</p><h3 id=heading-1><code>${}</code><a hidden class=anchor aria-hidden=true href=#heading-1>#</a></h3><p>위와 같이 문자 그대로 사용해야하는 경우에는 <code>${}</code>을 사용한다.
<code>${}</code>는 파라미터는 바인딩과 같은 작업없이 그대로 문자열로 치환하여 쿼리를 실행하므로, 성능상 빠르다.
그리고 문자 그대로 사용하므로 어디서든 사용이 가능하다.</p><p>하지만 SQL Injection 공격 등에 취약하여 안전상 문제가 있으므로 조건절에는 사용하지 않는 것이 좋다.</p><h1 id=4-주의할점-및-tip>4. 주의할점 및 TIP<a hidden class=anchor aria-hidden=true href=#4-주의할점-및-tip>#</a></h1><h2 id=조회-결과로-는-사용하지-말자>조회 결과로 <code>*</code>는 사용하지 말자<a hidden class=anchor aria-hidden=true href=#조회-결과로-는-사용하지-말자>#</a></h2><p>테이블의 모든 결과를 조회하고 싶을 때, 간편하게 <code>*</code>를 사용하는 경우가 있다.
하지만 이는 조회 결과를 매핑할 때 문제가 발생할 수 있다.
매핑 문제는 런타임에 발생하므로, 만약 테스트를 하지 않으면 실행 중 언제 에러가 발생할지 모른다.</p><p>또 한가지 문제점은 만약 테이블의 컬럼명이 바뀌거나 어떤 컬럼명을 사용하고 있는 SQL문을 찾고 싶은 경우
<code>*</code>를 사용하면 어떤 컬럼을 사용하고 있는지 알 수 없다는 것이다.
이는 유지보수 관점에서도 매우 좋지 않은 점이다.</p><p>그래서 조회할 때는 <code>*</code>를 사용하지 말고, <strong>필요한 컬럼만 명시적으로 작성</strong>하는 것이 좋다.</p><h1 id=참고자료>참고자료<a hidden class=anchor aria-hidden=true href=#참고자료>#</a></h1><ul><li><a href=https://mybatis.org/mybatis-3/ko/sqlmap-xml.html>https://mybatis.org/mybatis-3/ko/sqlmap-xml.html</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://parker1609.github.io/tags/mybatis/>MyBatis</a></li><li><a href=https://parker1609.github.io/tags/springboot/>SpringBoot</a></li><li><a href=https://parker1609.github.io/tags/java/>Java</a></li></ul><nav class=paginav><a class=prev href=https://parker1609.github.io/post/think/developer-study/><span class=title>« Prev</span><br><span>개발자 학습</span></a>
<a class=next href=https://parker1609.github.io/post/daily/2023-a-move/><span class=title>Next »</span><br><span>2023년 전세집 이사</span></a></nav></footer><div id=giscus_thread><script src=https://giscus.app/client.js data-repo=parker1609/parker1609.github.io data-repo-id=R_kgDOI_VMsw data-category=Announcements data-category-id=DIC_kwDOI_VMs84CUTZR data-mapping=og:title data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko data-loading=lazy crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://parker1609.github.io/>Parker Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>